var once=require("once"),noop=function(){},isRequest=function(e){return e.setHeader&&"function"==typeof e.abort},eos=function(e,n,o){if("function"==typeof n)return eos(e,null,n);n||(n={}),o=once(o||noop);var r=e._writableState,t=e._readableState,i=n.readable||!1!==n.readable&&e.readable,a=n.writable||!1!==n.writable&&e.writable,u=function(){e.writable||c()},c=function(){a=!1,i||o()},l=function(){return(!i||t&&t.ended)&&(!a||r&&r.ended)?void 0:o(new Error("premature close"))},f=function(){e.req.on("finish",c)};return isRequest(e)?(e.on("complete",c),e.on("abort",l),e.req?f():e.on("request",f)):a&&!r&&(e.on("end",u),e.on("close",u)),e.on("end",function(){i=!1,a||o()}),e.on("finish",c),!1!==n.error&&e.on("error",o),e.on("close",l),e};module.exports=eos;