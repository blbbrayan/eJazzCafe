function inspect(e){return seen=[],JSON.stringify(e,function(e,o){if(null!=o&&"object"==typeof o){if(seen.indexOf(o)>=0)return"[cyclic]";seen.push(o)}return o})}function apartContext(e,o,t){var n=require("vm");if(n){var c=n.createContext({ctx:e});t(n.runInContext(o,c))}else if(document&&document.createElement){var r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r);var a="tmpCtx"+Math.random();window[a]=e,r.src="test-apart-ctx.html?"+a+"&"+encodeURIComponent(o),r.onload=function(){try{t(r.contentWindow.results)}catch(e){throw e}}}else console.log("WARNING: cannot create an apart context.")}var clone=require("./");exports["clone string"]=function(e){e.expect(2);var o="foo";e.strictEqual(clone(o),o),o="",e.strictEqual(clone(o),o),e.done()},exports["clone number"]=function(e){e.expect(5);var o=0;e.strictEqual(clone(o),o),o=1,e.strictEqual(clone(o),o),o=-1e3,e.strictEqual(clone(o),o),o=3.1415927,e.strictEqual(clone(o),o),o=-3.1415927,e.strictEqual(clone(o),o),e.done()},exports["clone date"]=function(e){e.expect(3);var o=new Date,t=clone(o);e.ok(!!o.getUTCDate&&!!o.toUTCString),e.ok(!!t.getUTCDate&&!!t.toUTCString),e.equal(o.getTime(),t.getTime()),e.done()},exports["clone object"]=function(e){e.expect(1);var o={foo:{bar:"baz"}},t=clone(o);e.deepEqual(t,o),e.done()},exports["clone array"]=function(e){e.expect(2);var o=[{foo:"bar"},"baz"],t=clone(o);e.ok(t instanceof Array),e.deepEqual(t,o),e.done()},exports["clone buffer"]=function(e){if("undefined"==typeof Buffer)return e.done();e.expect(1);var o=new Buffer("this is a test buffer"),t=clone(o);e.deepEqual(t,o),e.done()},exports["clone regexp"]=function(e){e.expect(5);var o=/abc123/gi,t=clone(o);e.deepEqual(t,o);var n=/a/g;e.ok(0===n.lastIndex),n.exec("123a456a"),e.ok(4===n.lastIndex);var c=clone(n);e.ok(c.global),e.ok(4===c.lastIndex),e.done()},exports["clone object containing array"]=function(e){e.expect(1);var o={arr1:[{a:"1234",b:"2345"}],arr2:[{c:"345",d:"456"}]},t=clone(o);e.deepEqual(t,o),e.done()},exports["clone object with circular reference"]=function(e){function o(e,o){return inspect(e)===inspect(o)}e.expect(8);var t=[1,"foo",{hello:"bar"},function(){},!1,[2]],n={b:[t,2,3,4],c:t};n.loop=n,n.loop2=n,t.loop=t,t.aloop=n;var c=clone(n);e.ok(n!=c),e.ok(n.c!=c.c),e.ok(c.c==c.b[0]),e.ok(c.c.loop.loop.aloop==c),e.ok(c.c[0]==n.c[0]),e.ok(o(n,c)),c.c[0]=2,e.ok(!o(n,c)),c.c="2",e.ok(!o(n,c)),e.done()},exports["clone prototype"]=function(e){e.expect(3);var o={a:"aaa",x:123,y:45.65},t=clone.clonePrototype(o);e.strictEqual(t.a,o.a),e.strictEqual(t.x,o.x),e.strictEqual(t.y,o.y),e.done()},exports["clone within an apart context"]=function(e){apartContext({clone:clone},"results = ctx.clone({ a: [1, 2, 3], d: new Date(), r: /^foo$/ig })",function(o){e.ok(o.a.constructor.toString()===Array.toString()),e.ok(o.d.constructor.toString()===Date.toString()),e.ok(o.r.constructor.toString()===RegExp.toString()),e.done()})},exports["clone object with no constructor"]=function(e){e.expect(3);var o={foo:"bar"};o.__proto__=null,e.ok("object"==typeof o),e.ok(null!==typeof o);var t=clone(o);e.ok(o.foo,t.foo),e.done()},exports["clone object with depth argument"]=function(e){e.expect(6);var o={foo:{bar:{baz:"qux"}}},t=clone(o,!1,1);e.deepEqual(t,o),e.notEqual(t,o),e.strictEqual(t.foo,o.foo),t=clone(o,!0,2),e.deepEqual(t,o),e.notEqual(t.foo,o.foo),e.strictEqual(t.foo.bar,o.foo.bar),e.done()},exports["maintain prototype chain in clones"]=function(e){e.expect(1);var o=new function(){},t=clone(o);e.strictEqual(Object.getPrototypeOf(o),Object.getPrototypeOf(t)),e.done()},exports["parent prototype is overriden with prototype provided"]=function(e){e.expect(1);var o=new function(){},t=clone(o,!0,1/0,null);e.strictEqual(t.__defineSetter__,void 0),e.done()},exports["clone object with null children"]=function(e){e.expect(1);var o={foo:{bar:null,baz:{qux:!1}}},t=clone(o);e.deepEqual(t,o),e.done()},exports["clone instance with getter"]=function(e){function o(){}e.expect(1),Object.defineProperty(o.prototype,"prop",{configurable:!0,enumerable:!0,get:function(){return"value"}});var t=new o,n=clone(t);e.strictEqual(n.prop,"value"),e.done()},exports["get RegExp flags"]=function(e){e.strictEqual(clone.__getRegExpFlags(/a/),""),e.strictEqual(clone.__getRegExpFlags(/a/i),"i"),e.strictEqual(clone.__getRegExpFlags(/a/g),"g"),e.strictEqual(clone.__getRegExpFlags(/a/gi),"gi"),e.strictEqual(clone.__getRegExpFlags(/a/m),"m"),e.done()},exports["recognize Array object"]=function(e){apartContext(null,"results = [1, 2, 3]",function(o){var t=[4,5,6];e.ok(clone.__isArray(o)),e.ok(clone.__isArray(t)),e.ok(!clone.__isDate(o)),e.ok(!clone.__isDate(t)),e.ok(!clone.__isRegExp(o)),e.ok(!clone.__isRegExp(t)),e.done()})},exports["recognize Date object"]=function(e){apartContext(null,"results = new Date()",function(o){var t=new Date;e.ok(clone.__isDate(o)),e.ok(clone.__isDate(t)),e.ok(!clone.__isArray(o)),e.ok(!clone.__isArray(t)),e.ok(!clone.__isRegExp(o)),e.ok(!clone.__isRegExp(t)),e.done()})},exports["recognize RegExp object"]=function(e){apartContext(null,"results = /foo/",function(o){var t=/bar/;e.ok(clone.__isRegExp(o)),e.ok(clone.__isRegExp(t)),e.ok(!clone.__isArray(o)),e.ok(!clone.__isArray(t)),e.ok(!clone.__isDate(o)),e.ok(!clone.__isDate(t)),e.done()})};